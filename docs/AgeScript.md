# Age Script (Общее описание)
**Age Script** - упрощённый C-подобный скриптовый язык с ограниченным набором возможностей  
Скриптовый движок по возможности не генерирует ошибок и не прерывает выполнение, однако в некоторых случаях возможен вылет из игры

## Главные отличия от языка C
- Нельзя объявлять собственные функции. Разрешено использовать только встроенные
- Любой вызов функции должен быть присвоен переменной, иначе он будет проигнорирован движком
- Нет составных операторов присваивания (`+=`, `-=`, `*=`, `/=`, `%=`)
- Нет операторов инкремента и декремента (`a++`, `++a`, `a--`, `--a`)
- Нет управляющих конструкций while, for, switch
- Нет массивов и структур
- Все переменные глобальные (видимы во всех скриптах и диалогах)
- Все переменные игнорируют область видимости


## Типы данных
| Тип      | Описание                 |
|----------|--------------------------|
| `int`    | Целое со знаком          |
| `DWORD`  | Целое без знака          |
| `float`  | Число с плавающей точкой |
| `string` | Строка                   |


## Комментарии
Поддерживаются комментарии в стиле C++:
- Однострочные `// ...`
- Многострочные `/* ... */`


## Объявление переменных
Если нужно объявить переменную со значением можно воспользоваться файлом `scripts/dialog_special/zlato_vars.scr`  
Переменные из этого файла доступны из скриптов уровня и из скриптов диалогов

Особенности:
- Проверка необъявленной переменной на равенство 0 всегда возвращает true
```c
if (a == 0) { /* Проверка прошла успешно, даже если a не объявлена! */ }
```

- Инициализация в объявлении **игнорируется**, переменная всё равно получает значение по умолчанию
```c
int b = 0; // b is "0"
int с = 1; // c is "0"
```

- Значения по умолчанию для разных типов переменных
```c
int i; 	    // i is "0"
DWORD dw;   // dw is "0"
float f;    // f is "0"
string st;  // Невалидное значение, при попытке чтения - вылет из игры
```

Примеры объявлений:
```c
int a; 	     // Значение по умолчанию 0
int b = 0;   // То же самое - значение не присваивается
int d, e, f; // Допускается множественное объявление
```

## Присвоение
```c
int i;
DWORD dw;
float f;
string str;

i = -1;
dw = 1;
f = 0.5;
str = "String";
````
Если выполнить присвоение в **необъявленную** переменную, оно будет проигнорировано без ошибок, и скрипт продолжит выполнение.


## Просмотр и изменение переменных через консоль
Если в игре включена отладочная консоль, можно ввести имя переменной:
- Если переменная не объявлена сообщения не будет
- Если переменная объявлена будет сообщение вида: `x is "0"`
- **Осторожно!** Если строковая переменная объявлена, но значение ей не присвоено будет вылет из игры

Если через пробел ввести значение, то оно будет присвоенно переменной: `x 5`


## Операторы

### Арифметические
`+`, `-`, `*`, `/`, `%`

### Сравнения
`==`, `!=`, `>`, `<`, `>=`, `<=`

### Логические
`&&` - логическое И  
`||` - логическое ИЛИ  
`^^` - исключающее ИЛИ (XOR)  
`!`  - логическое НЕ

### Побитовые
`&`  - побитовое И  
`|`  - побитовое ИЛИ  
`^`  - побитовый XOR  
`~`  - побитовое НЕ  
`<<` - сдвиг влево  
`>>` - сдвиг вправо


## Оператор goto
Поддерживается в соответствии с C99  
Подробнее: https://en.cppreference.com/w/c/language/goto.html


## Оператор if-else
Условие в `if` обязательно должно быть заключено в круглые скобки  
Фигурные скобки у тела оператора — необязательные
```c
if a == 1 { /* Не сработает */ } 
if (a == 1) { /* Корректно */ } 

if (a >= 5) { }
else { }
```

Конструкция `else if` - не поддерживается
```c
// Не будет работать как ожидается
if (a == 1) {
	test = Console("if (a == 1)");
} else if (a == 2) {
	test = Console("else if (a == 2)");
} else {
	test = Console("else");
}

// Правильный вариант
if (a == 1) {
	test = Console("if (a == 1)");
} else {
	if (a == 2) {
		test = Console("else if (a == 2)");
	}  else {
		test = Console("else");
	}
}
```

Сравнение строк не работает. Условие всегда будет истинно
```c
// Будет вывод текста "Hello"
string st;
st = "World";
if (st == "Hello") { 
	test = Console("Hello");
}
```

## Полезные советы

### Эмуляция цикла while
```c
i = 1;
start:
	test = Console("print");
	i = i + 1;
	if (i <= 5) goto start;
```

### Вывести значение переменной в консоль
```c
var = 255;
result = Cmd("var");
```
